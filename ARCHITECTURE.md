# Deks 1.0 아키텍처 설계

## 🏗️ 전체 시스템 구조

```
┌─────────────────┐    Wi-Fi     ┌─────────────────┐    Websocket ┌─────────────────┐    HTTP/WebSocket   ┌─────────────────┐
|                 |              │Socket/WebSocket │              |                 |                     |                 |
│                 │◄────────────►│   브리지 서버    │◄────────────►│  FastAPI Server │◄───────────────────►│  Web Browser    │
│   ESP32 S3      │              │   (파이썬)      │              │                  │                     │                 │
│ (마이크로파이썬)  │              └─────────────────┘              │   (파이썬)       │                     │  (프론트엔드)    │
│                 │                                               │                 │                     │                 │
└─────────────────┘                                               └─────────────────┘                     └─────────────────┘
         │                                                        
         ▼                  
┌─────────────────┐              
│   하드웨어 센서   │             
│   • FIT0405 모터 │              
│   • 엔코더       │              
│   • 적외선 센서  │           
│   • 1588AS LED  │            
│   • 패시브 버저  │
└─────────────────┘
```

## 🧩 컴포넌트별 상세 구조

### 1. ESP32 S3 (로봇 두뇌)
```
┌─────────────────────────────────────────┐
│              ESP32 S3                   │
├─────────────────────────────────────────┤
│  • 마이크로파이썬 펌웨어                   │
│  • Wi-Fi 클라이언트                       │
│  • Socket 서버                           │
├─────────────────────────────────────────┤
│              제어 모듈                   │
│  • 모터 제어 (L298N)                     │
│  • 엔코더 읽기                           │
│  • 센서 데이터 수집                       │
│  • 안전 시스템                           │
├─────────────────────────────────────────┤
│              통신 모듈                   │
│  • 명령 수신 및 처리                      │
│  • 센서 데이터 전송                       │
│  • 상태 보고                             │
└─────────────────────────────────────────┘
```

### 2. WebSocket 브리지 서버
```
┌─────────────────────────────────────────┐
│      Socket-WebSocket Bridge Server     │
├─────────────────────────────────────────┤
│  • ESP32 ↔ 웹 브라우저 중계               │
│  • 실시간 데이터 스트리밍                  │
│  • 연결 상태 관리                         │
│  • 메시지 라우팅                          │
├─────────────────────────────────────────┤
│              기능 모듈                   │
│  • 센서 데이터 스트림                     │
│  • 로봇 상태 브로드캐스트                  │
│  • 사용자 명령 전달                       │
│  • 에러 알림                             │
└─────────────────────────────────────────┘
```

### 3. FastAPI 서버 (백엔드)
```
┌─────────────────────────────────────────┐
│            FastAPI Server               │
├─────────────────────────────────────────┤
│  • REST API 엔드포인트                    │
│  • WebSocket 연결 관리                    │
│  • 명령 처리 및 라우팅                     │
│  • 센서 데이터 저장/분석                   │
├─────────────────────────────────────────┤
│              핵심 모듈                    │
│  • 로봇 제어 API                          │
│  • 센서 데이터 API                        │
│  • 대화 처리 API                          │
│  • 매핑 데이터 API                        │
└─────────────────────────────────────────┘
```

### 4. 웹 프론트엔드
```
┌─────────────────────────────────────────┐
│           Web Frontend                  │
├─────────────────────────────────────────┤
│  • HTML5 + CSS3 + JavaScript            │
│  • WebSocket 클라이언트                   │
│  • 실시간 UI 업데이트                     │
│  • 사용자 인터랙션 처리                    │
├─────────────────────────────────────────┤
│              UI 컴포넌트                  │
│  • 채팅 인터페이스                        │
│  • 로봇 상태 모니터                       │
│  • 수동 제어 패널                         │
│  • 센서 데이터 시각화                      │
│  • 매핑 뷰어                             │
└─────────────────────────────────────────┘
```

## 🔄 데이터 흐름

### 1. 사용자 명령 흐름
```
사용자 입력 → 웹 프론트엔드 → WebSocket → FastAPI → Socket → ESP32 → 하드웨어 제어
```

### 2. 센서 데이터 흐름
```
하드웨어 센서 → ESP32 → Socket → FastAPI → WebSocket → 웹 프론트엔드 → UI 표시
```

### 3. 안전 시스템 흐름
```
센서 감지 → ESP32 (즉시 처리) → Socket → FastAPI (상태 보고) → 웹 (알림 표시)
```

## 🛡️ 안전 시스템 아키텍처

### 다층 안전 구조
```
1. 하드웨어 레벨 (ESP32)
   ├── 즉시 정지 (낙하 감지)
   ├── 모터 브레이크
   └── 비상 모드 진입

2. 소프트웨어 레벨 (FastAPI)
   ├── 센서 데이터 검증
   ├── 명령 안전성 검사
   └── 로봇 상태 모니터링

3. 사용자 레벨 (웹 인터페이스)
   ├── 수동 비상 정지 버튼
   ├── 위험 상태 알림
   └── 로봇 상태 실시간 표시
```

## 📊 성능 요구사항

### 실시간성
- **센서 데이터 수집**: 50Hz (20ms 간격)
- **명령 응답 시간**: < 100ms
- **안전 시스템 응답**: < 10ms

### 네트워크
- **Wi-Fi 연결**: 2.4GHz
- **데이터 전송량**: ~1KB/s
- **연결 안정성**: 자동 재연결 지원

## 🔄 확장성 고려사항

### 미래 확장 계획
1. **멀티 로봇 지원**: 여러 Deks 로봇 동시 제어
2. **클라우드 연동**: 원격 모니터링 및 제어
3. **AI 통합**: 음성 인식, 자연어 처리
4. **IoT 연동**: 스마트 홈 시스템 연결

### 모듈화 설계
- 각 컴포넌트는 독립적으로 교체 가능
- API 기반 통신으로 느슨한 결합
- 마이크로서비스 아키텍처 적용 가능

---

**Deks 1.0 아키텍처** - 확장 가능하고 안전한 로봇 플랫폼
